\section{Making a change}
\begin{frame}[fragile]
  \slidetitle

  In this section, we will learn how to:
  \begin{itemize}
    \item See the commit history
    \item Make commits that are actually changes
    \item Change commits and the history
  \end{itemize}
\end{frame}

\subsection{Commit logs}
\begin{frame}[fragile]
  \subslidetitle

  The command \cmd{git log} displays the commit history:
  \begin{lstlisting}
$ (*\textcolor[HTML]{0000AA}{git log}*)
(*\textcolor[HTML]{ae6617}{commit 633a534830c18a1747aaa5677aa6ec0b18f250c4}*)
Author: Andr(*é*) Roth <neolynx@gmail.com>
Date:   Sat Nov 21 13:51:18 2015 +0100

    green moon

(*\textcolor[HTML]{ae6617}{commit 368a328bbefccbdf5732ca90b95015061186e16a}*)
Author: Andr(*é*) Roth <neolynx@gmail.com>
Date:   Sat Nov 21 13:47:14 2015 +0100

    title in page

(*\textcolor[HTML]{ae6617}{commit 96c4f6a4f04bc206b2eb4ae30cd0fa3594cfabc3}*)
Author: Andr(*é*) Roth <neolynx@gmail.com>
Date:   Sat Nov 21 13:46:18 2015 +0100

    blue moon

...
\end{lstlisting}
Note: \cmd{git log} uses the pager for displaying the log, use \cmd{q} to quit.
\end{frame}

\subsection{Commit logs on one line}
\begin{frame}[fragile]
  \subslidetitle

  In our commit history, we find the following messages:
  \begin{lstlisting}
$ (*\textcolor[HTML]{0000AA}{git log --oneline}*)
(*\textcolor[HTML]{ae6617}{633a534}*) green moon
(*\textcolor[HTML]{ae6617}{368a328}*) title in page
(*\textcolor[HTML]{ae6617}{96c4f6a}*) blue moon
(*\textcolor[HTML]{ae6617}{5784ef6}*) we do not need the test file anymore
(*\textcolor[HTML]{ae6617}{13dbd70}*) adding test file
(*\textcolor[HTML]{ae6617}{3ce2637}*) change title
(*\textcolor[HTML]{ae6617}{220767d}*) add authors file
(*\textcolor[HTML]{ae6617}{39719c9}*) initial commit
\end{lstlisting}
\end{frame}

\subsection{Textmode Interface for git - tig}
\begin{frame}[fragile]
  \subslidetitle
  \cmd{tig} displays the history and allows to control git in a enhanced shell:
  \newline \vspace{1em}
  \centerline{\includegraphics[width=10.5cm]{../tig_screenshot.png}}
\end{frame}

\subsection{gitk}
\begin{frame}[fragile]
  \subslidetitle
  The program \cmd{gitk} allows to display and control git commits in a GUI:
  \\
  \vspace{1em}
  \centerline{\includegraphics[width=9cm]{../gitk.png}}
\end{frame}

\subsection{A commit is a change}
\begin{frame}[fragile]
  \subslidetitle

  Using git correctly means a commit is not just a saved snapshot of your ongoing work. \textbf{It is a change to you code.}

  \vspace{1em}
  Rules:
  \begin{itemize}
    \item A commit message is in imperative form: \\
      'add file', not 'adding file' or 'added file'
    \item A git commit contains only the diffs that are needed for that given change
    \item sha ?
      \item commiter, author ?

  \end{itemize}
\end{frame}


\subsection{Interactive rebase}
\begin{frame}[fragile]
  \subslidetitle

  Let's revisit the last 6 commits:
  \begin{lstlisting}
$ (*\textcolor[HTML]{0000AA}{git rebase -i HEAD\textasciitilde6}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{3ce2637}*) (*\textcolor[HTML]{682268}{change title}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{13dbd70}*) (*\textcolor[HTML]{682268}{adding test file}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{5784ef6}*) (*\textcolor[HTML]{682268}{we do not need the test file anymore}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{96c4f6a}*) (*\textcolor[HTML]{682268}{blue moon}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{368a328}*) (*\textcolor[HTML]{682268}{title in page}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{633a534}*) (*\textcolor[HTML]{682268}{green moon}*)

# Rebase 220767d..633a534 onto 220767d
#
...
\end{lstlisting}

  Note: the interactive \cmd{git rebase -i} will open your default text editor.
\end{frame}

\subsection{Interactive rebase commands}
\begin{frame}[fragile]
  \subslidetitle

  The interactive rebase allows to change the first column of one or more commits in oder to:

  \begin{itemize}
    \opt{p, pick}{use commit}
    \opt{r, reword}{use commit, but edit the commit message}
    \opt{e, edit}{use commit, but stop for amending}
    \opt{s, squash}{use commit, but meld into previous commit}
    \opt{f, fixup}{like "squash", but discard this commit's log message}
  \end{itemize}

  \vspace{1em}
  From the \cmd{git rebase -i} info:
  \begin{itemize}
    \item These lines can be re-ordered; they are executed from top to bottom.
    \item If you remove a line here THAT COMMIT WILL BE LOST.
    \item However, if you remove everything, the rebase will be aborted.
  \end{itemize}

\end{frame}

\subsection{Reword commit messages}
\begin{frame}[fragile]
  \subslidetitle

  Let's change the first column to \cmd{reword} or simply \cmd{r} of the commit messages we want to reword (in Vim: \cmd{cw r <ESC>}):
  \begin{lstlisting}
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{3ce2637}*) (*\textcolor[HTML]{682268}{change title}*)
(*\textcolor[HTML]{682268}{r}*) (*\textcolor[HTML]{349E9E}{13dbd70}*) (*\textcolor[HTML]{682268}{adding test file}*)
(*\textcolor[HTML]{682268}{r}*) (*\textcolor[HTML]{349E9E}{5784ef6}*) (*\textcolor[HTML]{682268}{we do not need the test file anymore}*)
(*\textcolor[HTML]{682268}{r}*) (*\textcolor[HTML]{349E9E}{96c4f6a}*) (*\textcolor[HTML]{682268}{blue moon}*)
(*\textcolor[HTML]{682268}{r}*) (*\textcolor[HTML]{349E9E}{368a328}*) (*\textcolor[HTML]{682268}{title in page}*)
(*\textcolor[HTML]{682268}{r}*) (*\textcolor[HTML]{349E9E}{633a534}*) (*\textcolor[HTML]{682268}{green moon}*)
\end{lstlisting}
  Then, save and exit (in Vim: \cmd{:wq})

  \vspace{1em}
  This will start the rebase operation by processing each commit, line by line, starting from top.

\end{frame}

\subsection{Changing a commit message}
\begin{frame}[fragile]
  \subslidetitle

  The \cmd{reword} command will open an editor, which allows to change the commit message:
  \begin{lstlisting}
(*\textcolor[HTML]{B7A000}{adding test file}*)

# Please enter the commit message for your changes. Lines
# starting with '#' will be ignored, and an empty message
# aborts the commit.
#
# Date:      Sat Nov 21 12:42:30 2015 +0100
#
# rebase in progress; onto 3ce2637
# You are currently editing a commit while rebasing branch 'master' on '3ce2637'.
#
# Changes to be committed:
#       new file:   (*\textcolor[HTML]{682268}{test.file}*)
\end{lstlisting}

\end{frame}

\subsection{Create nice commit messages}
\begin{frame}[fragile]
  \subslidetitle

  Now, change the commit title and message to the following:
  \begin{lstlisting}
(*\textcolor[HTML]{B7A000}{add test file}*)

The file `test.file' is needed for illustrating the `git rm'
command. It will be removed by the next commit.

\end{lstlisting}

  Save and quit the editor (in Vim: \cmd{:wq}).
  \\
  \vspace{1em}
  Then, the \cmd{git rebase -i} command will continue with the next commit.
  \\
  \vspace{1em}
  Change all commit messages to be imperative and add an explanatory commit text.
\end{frame}
\subsection{After the rebase}
\begin{frame}[fragile]
  \subslidetitle

   After the rebase operation you should see the following:
  \begin{lstlisting}
$ (*\textcolor[HTML]{0000AA}{git log --oneline}*)
(*\textcolor[HTML]{ae6617}{7218137}*) add green moon
(*\textcolor[HTML]{ae6617}{f7613af}*) change title in page
(*\textcolor[HTML]{ae6617}{bf18d68}*) change the color of the moon blue
(*\textcolor[HTML]{ae6617}{a550b98}*) remove test file
(*\textcolor[HTML]{ae6617}{88afdba}*) add test file
(*\textcolor[HTML]{ae6617}{3ce2637}*) change title
(*\textcolor[HTML]{ae6617}{220767d}*) add authors file
(*\textcolor[HTML]{ae6617}{39719c9}*) initial commit
\end{lstlisting}
\end{frame}

\subsection{Remove commits}
\begin{frame}[fragile]
  \subslidetitle
  An interactive rebase can be used to remove commits:
  \begin{lstlisting}
$ (*\textcolor[HTML]{0000AA}{git rebase -i HEAD\textasciitilde5}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{3bd32cc}*) (*\textcolor[HTML]{682268}{add test file}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{d3a51c8}*) (*\textcolor[HTML]{682268}{remove test file}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{8a713d1}*) (*\textcolor[HTML]{682268}{change the color of the moon blue}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{4c5ac7c}*) (*\textcolor[HTML]{682268}{change title in page}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{8c34fca}*) (*\textcolor[HTML]{682268}{add green moon}*)
\end{lstlisting}
  The first two commits are useless, remove the lines (in Vim: \cmd{dd}):
  \begin{lstlisting}
$ (*\textcolor[HTML]{0000AA}{git rebase -i HEAD\textasciitilde5}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{8a713d1}*) (*\textcolor[HTML]{682268}{change the color of the moon blue}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{4c5ac7c}*) (*\textcolor[HTML]{682268}{change title in page}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{8c34fca}*) (*\textcolor[HTML]{682268}{add green moon}*)
\end{lstlisting}


  Then save and quit the editor.

\end{frame}

\subsection{Reorder commits}
\begin{frame}[fragile]
  \subslidetitle
  An interactive rebase can be used to reorder commits:

  \begin{lstlisting}
$ (*\textcolor[HTML]{0000AA}{git rebase -i HEAD\textasciitilde4}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{3ce2637}*) (*\textcolor[HTML]{682268}{change title}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{aca9316}*) (*\textcolor[HTML]{682268}{change the color of the moon blue}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{1ee6e3e}*) (*\textcolor[HTML]{682268}{change title in page}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{f738e37}*) (*\textcolor[HTML]{682268}{add green moon}*)
\end{lstlisting}

  The commits can be grouped logically in title changes and moon color changes.\\
  Use copy \& paste to reorder the commits (in Vim: \cmd{yy} \& \cmd{p}):

  \begin{lstlisting}
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{3ce2637}*) (*\textcolor[HTML]{682268}{change title}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{1ee6e3e}*) (*\textcolor[HTML]{682268}{change title in page}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{aca9316}*) (*\textcolor[HTML]{682268}{change the color of the moon blue}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{f738e37}*) (*\textcolor[HTML]{682268}{add green moon}*)
\end{lstlisting}

  Save and quit the editor to reorder the commits.
\end{frame}


\subsection{Fixup commits}
\begin{frame}[fragile]
  \subslidetitle
  An interactive rebase can be used to fixup commits:

  \begin{lstlisting}
$ (*\textcolor[HTML]{0000AA}{git rebase -i HEAD\textasciitilde4}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{3ce2637}*) (*\textcolor[HTML]{682268}{change title}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{1ee6e3e}*) (*\textcolor[HTML]{682268}{change title in page}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{aca9316}*) (*\textcolor[HTML]{682268}{change the color of the moon blue}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{f738e37}*) (*\textcolor[HTML]{682268}{add green moon}*)
\end{lstlisting}

  The first two are actually the same change, fix them up by setting the first
  column of the second commit to \cmd{fixup} or simply \cmd{f} (in Vim: \cmd{cw f <ESC>}):

  \begin{lstlisting}
$ (*\textcolor[HTML]{0000AA}{git rebase -i HEAD\textasciitilde4}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{3ce2637}*) (*\textcolor[HTML]{682268}{change title}*)
(*\textcolor[HTML]{B7A000}{f}*) (*\textcolor[HTML]{349E9E}{1ee6e3e}*) (*\textcolor[HTML]{682268}{change title in page}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{aca9316}*) (*\textcolor[HTML]{682268}{change the color of the moon blue}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{f738e37}*) (*\textcolor[HTML]{682268}{add green moon}*)
\end{lstlisting}

  Save and quit the editor to fixup the commits.
\end{frame}

\subsection{Squash commits}
\begin{frame}[fragile]
  \subslidetitle
  An interactive rebase can be used to squash commits:
  \begin{lstlisting}
$ (*\textcolor[HTML]{0000AA}{git rebase -i HEAD\textasciitilde3}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{3fbbf93}*) (*\textcolor[HTML]{682268}{change title}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{aca9316}*) (*\textcolor[HTML]{682268}{change the color of the moon blue}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{f738e37}*) (*\textcolor[HTML]{682268}{add green moon}*)
\end{lstlisting}

  The last two commit are very similar, meld them by setting the first
  column of the second commit to \cmd{squash} or simply \cmd{s} (in Vim: \cmd{cw s <ESC>}):
  \begin{lstlisting}
$ (*\textcolor[HTML]{0000AA}{git rebase -i HEAD\textasciitilde3}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{3fbbf93}*) (*\textcolor[HTML]{682268}{change title}*)
(*\textcolor[HTML]{B7A000}{pick}*) (*\textcolor[HTML]{349E9E}{aca9316}*) (*\textcolor[HTML]{682268}{change the color of the moon blue}*)
(*\textcolor[HTML]{B7A000}{s}*) (*\textcolor[HTML]{349E9E}{f738e37}*) (*\textcolor[HTML]{682268}{add green moon}*)
\end{lstlisting}
  Save and quit the editor to squash the commits. This will open an editor.
\end{frame}

\subsection{Squash commits}
\begin{frame}[fragile]
  \subslidetitle
  The commit message of both commits to be squashed can be modified now:
  \begin{lstlisting}
# This is a combination of 2 commits.
# The first commit's message is:

change the color of the moon blue

# This is the 2nd commit message:

add green moon
\end{lstlisting}

  Change it to:
  \begin{lstlisting}
# This is a combination of 2 commits.

change the color of the moon blue and add green moon

\end{lstlisting}
  Save and quit the editor.
\end{frame}

\subsection{After the interactive rebase}
\begin{frame}[fragile]
  \subslidetitle

  The commits are now consistent and understandable:
  \begin{lstlisting}
$ (*\textcolor[HTML]{0000AA}{git log --oneline}*)
(*\textcolor[HTML]{ae6617}{2fdc7c2}*) change the color of the moon blue and add green moon
(*\textcolor[HTML]{ae6617}{3fbbf93}*) change title
(*\textcolor[HTML]{ae6617}{220767d}*) add authors file
(*\textcolor[HTML]{ae6617}{39719c9}*) initial commit
\end{lstlisting}

\end{frame}

%\subsection{git status}
%\begin{frame}[fragile]
    %\subslidetitle
%Notice the following 3 states:
%\begin{itemize}
%\item untracked (new files): every file which is not under version control.
%\item modified (changed to be tracked): every file already under version control, who has been modified.
%\item tracked (change to be committed): every file you intend to commit are added to the staging area.
%\item committed (invisible): bundle of files forming a commit, ready to be pushed to a remote.
%\end{itemize}

%The \cmd{git status} is used to give a current overview of your files.

%Additionally git also specify the current branch we are working on.
%\end{frame}

%\subsection{git reset}
%\begin{frame}[fragile]
    %\subslidetitle
%% --hard
%% --soft
%% --mixed
%% master@{"10 minutes ago"}
%\end{frame}

%\subsection{git diff}
%\begin{frame}[fragile]
    %\subslidetitle
%% --staged
%\end{frame}

%\subsection{git grep}
%\begin{frame}[fragile]
    %\subslidetitle
%\end{frame}

